(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class m{constructor(t,e,s=1){this.width=t,this.height=e,this.points=[],this.totalLength=0,this.generateSpiral()}generateSpiral(){const t=this.width/2,e=this.height/2,s=Math.min(this.width,this.height)*.45,i=3,n=500;for(let l=0;l<=n;l++){const a=l/n,d=a*Math.PI*2*i,h=s*(1-a*.8),o=t+Math.cos(d)*h,c=e+Math.sin(d)*h;this.points.push({x:o,y:c})}this.segmentLengths=[];for(let l=0;l<this.points.length-1;l++){const a=this.points[l],d=this.points[l+1],h=Math.hypot(d.x-a.x,d.y-a.y);this.segmentLengths.push(h),this.totalLength+=h}}getPointAt(t){if(t<0){const s=this.points[0],i=this.points[1],n=Math.atan2(i.y-s.y,i.x-s.x),l=s.x+Math.cos(n)*t,a=s.y+Math.sin(n)*t;return{x:l,y:a,angle:n}}if(t>=this.totalLength){const s=this.points[this.points.length-1],i=this.points[this.points.length-2],n=Math.atan2(s.y-i.y,s.x-i.x);return{...s,angle:n}}let e=0;for(let s=0;s<this.segmentLengths.length;s++){const i=this.segmentLengths[s];if(e+i>=t){const l=(t-e)/i,a=this.points[s],d=this.points[s+1],h=a.x+(d.x-a.x)*l,o=a.y+(d.y-a.y)*l,c=Math.atan2(d.y-a.y,d.x-a.x);return{x:h,y:o,angle:c}}e+=i}return this.points[this.points.length-1]}}class w{constructor(t,e=1){this.path=t,this.balls=[],this.ballRadius=18,this.speed=50+e*5,this.colors=["#ff0055","#00f2ff","#00ff00","#ffff00"],this.spawnTimer=0,this.spawnInterval=this.ballRadius*2/this.speed,this.maxBalls=20+e*10,this.spawnedCount=0,this.nextId=0,this.preSpawnBalls(1)}preSpawnBalls(t){for(let e=0;e<t;e++){const s=this.colors[Math.floor(Math.random()*this.colors.length)];this.balls.push({id:this.nextId++,color:s,distance:0,radius:this.ballRadius}),this.spawnedCount++}}update(t,e){if(this.spawnedCount<this.maxBalls&&(this.spawnTimer+=t,this.spawnTimer>=this.spawnInterval&&(this.spawnBall(),this.spawnTimer=0)),this.balls.length===0)return;const s=this.ballRadius*2,i=2,n=this.speed*4;this.balls.sort((h,o)=>h.distance-o.distance);let l=[],a=[this.balls[0]];for(let h=1;h<this.balls.length;h++){const o=this.balls[h],c=this.balls[h-1];o.distance-c.distance<=s+i?a.push(o):(l.push(a),a=[o])}l.push(a);for(let h=0;h<l.length;h++){const o=l[h];let c=0;if(h===0)c=this.speed;else{const u=l[h-1],P=u[u.length-1],C=o[0].distance-P.distance-s,M=Math.min(C/50,1.5);c=-n*(.5+M)}for(const u of o)u.distance+=c*t}for(let h=1;h<this.balls.length;h++){const o=this.balls[h],c=this.balls[h-1];o.distance<c.distance+s&&(o.distance=c.distance+s)}let d=0;for(;d<this.balls.length;){let h=this.balls[d].color,o=1,c=d+1;for(;c<this.balls.length&&this.balls[c].color===h&&this.balls[c].distance-this.balls[c-1].distance<=s+i;)o++,c++;o>=3?(this.balls.splice(d,o),e&&e(o)):d=c}}spawnBall(){let t,e=0,s=null,i=null;for(const l of this.balls)!s||Math.abs(l.distance)<Math.abs(s.distance)?(i=s,s=l):(!i||Math.abs(l.distance)<Math.abs(i.distance))&&(i=l);if(s&&i&&s.color===i.color)do t=this.colors[Math.floor(Math.random()*this.colors.length)],e++;while(e<10&&t===s.color);else t=this.colors[Math.floor(Math.random()*this.colors.length)];let n=0;s&&(n=s.distance-this.ballRadius*2),this.balls.push({id:this.nextId++,color:t,distance:n,radius:this.ballRadius}),this.spawnedCount++}hasReachedEnd(){return this.balls.length===0?!1:this.balls[this.balls.length-1].distance>=this.path.totalLength}isEmpty(){return this.balls.length===0}hasFinishedSpawning(){return this.spawnedCount>=this.maxBalls}checkCollision(t){for(let e=0;e<this.balls.length;e++){const s=this.balls[e],i=this.path.getPointAt(s.distance),n=i.x-t.x,l=i.y-t.y;if(Math.sqrt(n*n+l*l)<s.radius+t.radius)return{index:e,ball:s,x:i.x,y:i.y}}return null}insertBall(t,e){const s=this.balls[e],i={id:this.nextId++,color:t.color,distance:s.distance,radius:this.ballRadius};this.balls.splice(e,0,i);let n=e;for(;n<this.balls.length-1;){const l=this.balls[n],a=this.balls[n+1];a.distance-l.distance<this.ballRadius*2&&(a.distance=l.distance+this.ballRadius*2),n++}return e}checkMatches(t){if(t<0||t>=this.balls.length)return 0;const e=this.balls[t].color;let s=1,i=t;for(let n=t-1;n>=0&&this.balls[n].color===e;n--)s++,i=n;for(let n=t+1;n<this.balls.length&&this.balls[n].color===e;n++)s++;return s>=3?(this.balls.splice(i,s),s):0}}class b{constructor(t,e){this.x=t,this.y=e,this.angle=0,this.colors=["#ff0055","#00f2ff","#00ff00","#ffff00"],this.radius=25,this.currentBall=this.getRandomColor(),this.nextBall=this.getRandomColor(),this.cooldown=0,this.cooldownTime=.3}getRandomColor(){return this.colors[Math.floor(Math.random()*this.colors.length)]}updateAngle(t,e){this.angle=Math.atan2(e-this.y,t-this.x)}shoot(){if(this.cooldown>0)return null;const t={x:this.x+Math.cos(this.angle)*this.radius,y:this.y+Math.sin(this.angle)*this.radius,vx:Math.cos(this.angle)*800,vy:Math.sin(this.angle)*800,color:this.currentBall,radius:18};return this.currentBall=this.nextBall,this.nextBall=this.getRandomColor(),this.cooldown=this.cooldownTime,t}update(t){this.cooldown>0&&(this.cooldown-=t)}}class R{constructor(t,e,s){this.ctx=t,this.width=e,this.height=s}clear(){this.ctx.clearRect(0,0,this.width,this.height)}drawPath(t){if(t.points.length<2)return;this.ctx.beginPath(),this.ctx.moveTo(t.points[0].x,t.points[0].y);for(let s=1;s<t.points.length;s++)this.ctx.lineTo(t.points[s].x,t.points[s].y);this.ctx.shadowBlur=15,this.ctx.shadowColor="rgba(0, 242, 255, 0.5)",this.ctx.strokeStyle="rgba(255, 255, 255, 0.1)",this.ctx.lineWidth=45,this.ctx.stroke(),this.ctx.shadowBlur=0,this.ctx.strokeStyle="rgba(0, 242, 255, 0.2)",this.ctx.lineWidth=2,this.ctx.stroke();const e=t.points[t.points.length-1];this.drawSkull(e.x,e.y)}drawSkull(t,e){this.ctx.save(),this.ctx.translate(t,e),this.ctx.fillStyle="#ff0055",this.ctx.shadowBlur=20,this.ctx.shadowColor="#ff0055",this.ctx.beginPath(),this.ctx.arc(0,0,20,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#000",this.ctx.shadowBlur=0,this.ctx.font="20px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("â˜ ",0,2),this.ctx.restore()}drawBall(t,e,s,i){const n=this.ctx.createRadialGradient(t-s/3,e-s/3,s/10,t,e,s);n.addColorStop(0,"#fff"),n.addColorStop(.3,i),n.addColorStop(1,"#000"),this.ctx.fillStyle=n,this.ctx.shadowBlur=10,this.ctx.shadowColor=i,this.ctx.beginPath(),this.ctx.arc(t,e,s,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="rgba(255, 255, 255, 0.8)",this.ctx.shadowBlur=0,this.ctx.beginPath(),this.ctx.arc(t-s/3,e-s/3,s/4,0,Math.PI*2),this.ctx.fill()}drawChain(t){for(const e of t.balls){const s=t.path.getPointAt(e.distance);this.drawBall(s.x,s.y,e.radius,e.color)}}drawShooter(t){this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle);const e=this.ctx.createLinearGradient(0,0,400,0);e.addColorStop(0,"rgba(0, 242, 255, 0.6)"),e.addColorStop(.5,"rgba(0, 242, 255, 0.3)"),e.addColorStop(1,"rgba(0, 242, 255, 0)"),this.ctx.strokeStyle=e,this.ctx.lineWidth=2,this.ctx.setLineDash([10,5]),this.ctx.beginPath(),this.ctx.moveTo(t.radius,0),this.ctx.lineTo(400,0),this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.restore(),this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle),this.ctx.fillStyle="#222",this.ctx.shadowBlur=15,this.ctx.shadowColor="#00f2ff",this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="#333",this.ctx.fillRect(0,-10,40,20),this.ctx.restore(),this.drawBall(t.x,t.y,18,t.currentBall),this.drawBall(t.x-35,t.y+35,12,t.nextBall)}drawProjectiles(t){for(const e of t)this.drawBall(e.x,e.y,e.radius,e.color)}}class E{constructor(t,e){this.canvas=t,this.ctx=t.getContext("2d"),this.callbacks=e,this.width=t.width,this.height=t.height,this.score=0,this.level=1,this.isRunning=!1,this.isPaused=!1,this.lastTime=0,this.path=new m(this.width,this.height),this.chain=new w(this.path),this.shooter=new b(this.width/2,this.height/2),this.renderer=new R(this.ctx,this.width,this.height),this.canvas.addEventListener("mousemove",s=>{if(!this.isRunning||this.isPaused)return;const i=this.canvas.getBoundingClientRect();this.shooter.updateAngle(s.clientX-i.left,s.clientY-i.top)}),this.canvas.addEventListener("mousedown",s=>{if(!this.isRunning||this.isPaused)return;const i=this.shooter.shoot();i&&this.projectiles.push(i)})}togglePause(){this.isRunning&&(this.isPaused=!this.isPaused,this.isPaused||(this.lastTime=performance.now()),this.callbacks.onPauseToggle&&this.callbacks.onPauseToggle(this.isPaused))}start(){this.score=0,this.level=1,this.resetLevel(),this.isRunning=!0,this.isPaused=!1,this.lastTime=performance.now(),this.callbacks.onScoreUpdate(this.score),this.callbacks.onLevelUpdate(this.level),requestAnimationFrame(t=>this.loop(t))}restart(){this.start()}nextLevel(){this.level++,this.callbacks.onLevelUpdate(this.level),this.resetLevel(),this.isRunning=!0,this.isPaused=!1,this.lastTime=performance.now(),requestAnimationFrame(t=>this.loop(t))}resetLevel(){this.path=new m(this.canvas.width,this.canvas.height,this.level),this.chain=new w(this.path,this.level),this.shooter=new b(this.canvas.width/2,this.canvas.height/2),this.projectiles=[],this.particles=[]}loop(t){if(!this.isRunning)return;const e=(t-this.lastTime)/1e3;this.lastTime=t,this.update(e),this.draw(),requestAnimationFrame(s=>this.loop(s))}update(t){if(!this.isPaused){if(this.shooter.update(t),this.chain.update(t,e=>{this.score+=e*100,this.callbacks.onScoreUpdate(this.score)}),this.chain.hasReachedEnd()){this.isRunning=!1,this.callbacks.onGameOver(this.score);return}if(this.chain.isEmpty()&&this.chain.hasFinishedSpawning()){this.isRunning=!1,this.callbacks.onVictory();return}for(let e=this.projectiles.length-1;e>=0;e--){const s=this.projectiles[e];if(s.x+=s.vx*t,s.y+=s.vy*t,s.x<-50||s.x>this.width+50||s.y<-50||s.y>this.height+50){this.projectiles.splice(e,1);continue}const i=this.chain.checkCollision(s);if(i){this.chain.insertBall(s,i.index),this.projectiles.splice(e,1);const n=this.chain.checkMatches(i.index);n>0&&(this.score+=n*100,this.callbacks.onScoreUpdate(this.score))}}}}draw(){this.renderer.clear(),this.renderer.drawPath(this.path),this.renderer.drawChain(this.chain),this.renderer.drawShooter(this.shooter),this.renderer.drawProjectiles(this.projectiles)}}const p=document.getElementById("gameCanvas"),k=document.getElementById("start-btn"),T=document.getElementById("restart-btn"),I=document.getElementById("next-level-btn"),j=document.getElementById("start-screen"),B=document.getElementById("game-over-screen"),S=document.getElementById("victory-screen"),y=document.getElementById("countdown-screen"),f=document.getElementById("countdown-number"),v=document.getElementById("pause-screen");function L(){p.width=window.innerWidth,p.height=window.innerHeight}window.addEventListener("resize",L);L();const g=new E(p,{onGameOver:r=>{document.getElementById("final-score-display").textContent=`Score: ${r}`,B.classList.remove("hidden")},onVictory:()=>{S.classList.remove("hidden")},onScoreUpdate:r=>{document.getElementById("score").textContent=r},onLevelUpdate:r=>{document.getElementById("level").textContent=r},onPauseToggle:r=>{r?v.classList.remove("hidden"):v.classList.add("hidden")}});window.addEventListener("keydown",r=>{r.code==="Space"&&(r.preventDefault(),g.togglePause())});function x(r){y.classList.remove("hidden");let t=3;const e=()=>{t>0?(f.textContent=t,f.style.animation="none",setTimeout(()=>{f.style.animation="countdownPulse 1s ease-in-out"},10),t--,setTimeout(e,1e3)):(y.classList.add("hidden"),r())};e()}k.addEventListener("click",()=>{j.classList.add("hidden"),x(()=>g.start())});T.addEventListener("click",()=>{B.classList.add("hidden"),x(()=>g.restart())});I.addEventListener("click",()=>{S.classList.add("hidden"),x(()=>g.nextLevel())});
